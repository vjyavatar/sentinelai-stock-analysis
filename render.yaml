# render.yaml - SentinelAI Complete Deployment Blueprint
# ===========================================================
# Place this in ROOT of your GitHub repository
# Push to GitHub → Connect Render → Auto-deploy! ✅
# ===========================================================

services:
  # ============================================
  # PostgreSQL Database
  # ============================================
  - type: pserv
    name: sentinelai-postgres
    plan: starter
    region: oregon
    databaseName: stockanalysis
    databaseUser: admin

  # ============================================
  # Python AI Service (FastAPI)
  # ============================================
  - type: web
    name: sentinelai-python-ai
    runtime: python
    region: oregon
    plan: starter
    buildCommand: "pip install -r python-service/requirements.txt"
    startCommand: "cd python-service && uvicorn main:app --host 0.0.0.0 --port $PORT"
    healthCheckPath: /health
    envVars:
      - key: ANTHROPIC_API_KEY
        sync: false  # Set manually in Render dashboard
      - key: PORT
        value: 8000

  # ============================================
  # Spring Boot Backend
  # ============================================
  - type: web
    name: sentinelai-spring-backend
    runtime: docker
    region: oregon
    plan: starter
    dockerfilePath: ./spring-backend/Dockerfile
    dockerContext: ./spring-backend
    healthCheckPath: /actuator/health
    envVars:
      # Database (auto-populated by Render)
      - key: DATABASE_URL
        fromDatabase:
          name: sentinelai-postgres
          property: connectionString
      
      # Python Service URL (auto-populated by Render)
      - key: PYTHON_SERVICE_URL
        fromService:
          type: web
          name: sentinelai-python-ai
          envVarKey: RENDER_EXTERNAL_URL
      
      # API Keys (set manually in Render dashboard)
      - key: ANTHROPIC_API_KEY
        sync: false
      
      # Security (auto-generated by Render)
      - key: JWT_SECRET
        generateValue: true
      
      # Application Config
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: PORT
        value: 8080
      - key: REDIS_HOST
        value: localhost

# ============================================
# Optional: Add Redis for caching
# ============================================
# Uncomment this section if you want Redis caching:
#
#  - type: redis
#    name: sentinelai-redis
#    plan: starter
#    region: oregon
#    maxmemoryPolicy: allkeys-lru
#
# Then update Spring Boot service:
#      - key: REDIS_HOST
#        fromService:
#          type: redis
#          name: sentinelai-redis
#          property: host

# ============================================
# DEPLOYMENT STEPS:
# ============================================
# 1. Add this file to root of your GitHub repo
# 2. Push to GitHub
# 3. Go to https://render.com
# 4. Click "New +" → "Blueprint"
# 5. Connect your GitHub repo
# 6. Render reads this file and creates ALL services!
# 7. Set ANTHROPIC_API_KEY in each service's environment
# 8. Done! Everything deploys automatically ✅
#
# Total time: 5 minutes
# Cost: FREE (starter plan) or ~$21/month (paid plan)
# ============================================
